<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="cart">

	<!-- 장바구니 추가 -->
	<insert id="insert" parameterType="com.web.shop.cart.dto.CartDTO">
		INSERT INTO CART_T(
			cid, userid, pid, cartqty
		) VALUES (
			seq_cart.NEXTVAL, #{userid}, #{pid}, #{cartqty}
		)
	</insert>

	<!-- 장바구니 목록 -->
	<select id="listCart" resultType="com.web.shop.cart.dto.CartDTO">
		SELECT
			c.CID AS cid,
			c.USERID AS userid,
			p.PID AS pid,
			u.USERNAME AS username,
			p.PRODUCTNAME AS productname,
			c.CARTQTY,
			p.PRICE AS price,
			(price * cartqty) totalprice
		FROM
			USER_T u, PRODUCT_T p, CART_T c
		WHERE u.userid = c.userid
			AND p.pid = c.pid
			AND c.userid = #{userid}
		ORDER BY
			c.cid
	</select>
	
    <!-- 장바구니 전체 금액 -->
    <select id="sumtotalmoney" resultType ="int">
    	SELECT NVL(SUM(price * cartqty), 0) totalprice
    	FROM CART_T c, PRODUCT_T p
    	WHERE c.pid = p.pid AND c.userid = #{userid}
     </select>
     
    <!-- 장바구니 수정  -->
    <update id="modify">
    	UPDATE CART_T
    	SET CARTQTY = #{cartqty}
    	WHERE USERID = #{userid}
    	AND PID = #{pid} 
    </update>
    
    <!-- 장바구니 삭제 -->
    <delete id="delete">
    	DELETE FROM CART_T
    	WHERE cid = #{cid}
    </delete>
    
    <!-- 장바구니 상품 중복 확인 -->
    <select id="countCart" resultType="int">
    	SELECT COUNT(*)
    	FROM CART_T
    	WHERE userid = #{userid}
    	AND pid = #{pid}
    </select>
    
    <!-- 장바구니 상품 중복시 수정  -->
    <update id="update">
    	UPDATE CART_T
    	SET cartqty = cartqty + #{cartqty}
    	WHERE userid = #{userid}
    	AND pid = #{pid}
    </update>
</mapper>