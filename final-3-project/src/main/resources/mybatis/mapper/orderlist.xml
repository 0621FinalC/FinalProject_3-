<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="orderlistMapper">

  <select id="all" parameterType="hashmap" resultType="order">
  	SELECT * FROM order_t
	WHERE userid = #{userid}
	<if test="year != 0">
		AND orderdate >= TO_DATE(#{year}, 'YYYY')					
		AND orderdate &lt; TO_DATE(#{year} + 1, 'YYYY')
	</if>
	ORDER BY orderdate DESC
  </select>
  
  <select id="order" parameterType="string" resultType="orderdetail">
  	SELECT a.pid, a.productname, a.price * b.item_qty AS total_price, b.item_qty
	FROM product_t a
	JOIN order_detail b ON a.productname = b.productname
	WHERE b.oid = #{oid}
	ORDER BY a.productname DESC
  </select>
  
  <select id="deliver" parameterType="string" resultType="delivery">
  	SELECT sender, rec_name, rec_phone, rec_address, shipping_fee,
		(SELECT username FROM user_t WHERE userid = (SELECT userid FROM order_t WHERE oid = #{oid})) AS username
	FROM delivery_info
	WHERE oid = #{oid}
  </select>
  
</mapper>
